<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Registro de movimientos - SafeProducts">
    <meta name="theme-color" content="#2563eb">
    <title>Movimientos - SafeProducts</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192x192.png">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav id="navbar"></nav>

    <main class="main-content">
        <div class="container">
            <div style="display:flex;gap:1.5rem;flex-wrap:wrap;margin-top:1rem;">
                <!-- Formulario de Registro -->
                <div style="flex:1;min-width:320px;max-width:520px;">
                    <div class="stat-card">
                        <h3 style="margin-bottom:1rem;font-size:1.25rem;">Registrar Movimiento</h3>
                        <form id="movementForm">
                            <div class="form-group">
                                <label for="productSelect">Producto *</label>
                                <select id="productSelect" required style="width:100%;padding:0.75rem;border-radius:8px;border:1px solid #e5e7eb;">
                                    <option value="">— Selecciona un producto —</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="movementType">Tipo de Movimiento *</label>
                                <select id="movementType" required style="width:100%;padding:0.75rem;border-radius:8px;border:1px solid #e5e7eb;">
                                    <option value="entrada">Entrada (Agregar stock)</option>
                                    <option value="salida">Salida (Reducir stock)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="movementQty">Cantidad *</label>
                                <input 
                                    type="number" 
                                    id="movementQty" 
                                    min="1" 
                                    value="1" 
                                    required 
                                    style="width:100%;padding:0.75rem;border-radius:8px;border:1px solid #e5e7eb;"
                                >
                            </div>

                            <div class="form-group">
                                <label for="movementNote">Nota (opcional)</label>
                                <input 
                                    type="text" 
                                    id="movementNote" 
                                    placeholder="Ej: Recepción de proveedor" 
                                    style="width:100%;padding:0.75rem;border-radius:8px;border:1px solid #e5e7eb;"
                                >
                            </div>

                            <div id="movementError" class="error-message hidden"></div>

                            <button id="btnSaveMovement" class="btn-primary" type="submit" style="width:100%;margin-top:0.5rem;">
                                Registrar Movimiento
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Historial de Movimientos -->
                <div style="flex:2;min-width:320px;">
                    <div class="stat-card">
                        <h3 style="margin-bottom:1rem;font-size:1.25rem;">Historial de Movimientos</h3>
                        <div id="movementsList" style="max-height:600px;overflow-y:auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer id="footer"></footer>

    <!-- Scripts en ORDEN CORRECTO -->
    <script src="js/offline-handler.js"></script>
    <script src="js/db.js"></script>
    <script type="module" src="js/firebase-config.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
    <script src="js/movimientos.js"></script>
    
    <script>
        // Inicializar componentes
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                if (window.Components && typeof window.Components.initComponents === 'function') {
                    window.Components.initComponents({ 
                        title: 'Movimientos',
                        showBack: true,
                        backUrl: 'home.html'
                    });
                }
            });
        } else {
            if (window.Components && typeof window.Components.initComponents === 'function') {
                window.Components.initComponents({ 
                    title: 'Movimientos',
                    showBack: true,
                    backUrl: 'home.html'
                });
            }
        }
    </script>
</body>
</html>